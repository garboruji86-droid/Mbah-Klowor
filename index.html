<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MbahKlowor AI Voice Over Studio</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Studio suara AI pintar dengan gaya narasi Storytelling dan Reflektif.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.all.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #090b11; color: white; overflow-x: hidden; }
        .glass-card { background: rgba(17, 21, 30, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        .text-orange-custom { color: #f97316; } /* Orange-500 */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const Icon = ({ name, className = "w-6 h-6" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name.toLowerCase());
                    i.className = className;
                    iconRef.current.appendChild(i);
                    window.lucide.createIcons({
                        attrs: { class: className },
                        nameAttr: 'data-lucide',
                        icons: window.lucide.icons
                    });
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"></span>;
        };

        const App = () => {
            const [text, setText] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [style, setStyle] = useState('Storytelling');
            const [mainLang, setMainLang] = useState('Indonesia');
            const [subLang, setSubLang] = useState('Standar Indonesia');
            const [selectedVoice, setSelectedVoice] = useState('Puck'); 

            const [audioUrl, setAudioUrl] = useState(null);
            const [error, setError] = useState(null);
            const audioRef = useRef(null);
            const apiKey = "AIzaSyDU32KAbyA1DHIGb-xl_j0lsBW-JR1z9Tk"; 

            const languageMap = {
                'Indonesia': ['Standar Indonesia', 'Logat Jawa', 'Logat Sunda', 'Logat Melayu', 'Aksen Timur'],
                'English': ['US English', 'British English', 'Australian English', 'Indian English']
            };

            const voiceDatabase = {
                'Indonesia': [
                    { id: 'Puck', name: 'Budi (Pria)', type: 'Bariton Professional', avatar: 'ðŸ§”' },
                    { id: 'Kore', name: 'Siti (Wanita)', type: 'Ramah & Jelas', avatar: 'ðŸ‘©' },
                    { id: 'Charon', name: 'Eko (Pria)', type: 'Narasi Berat', avatar: 'ðŸ‘´' },
                    { id: 'Zephyr', name: 'Laras (Wanita)', type: 'Anggun & Lembut', avatar: 'ðŸ‘±â€â™€ï¸' },
                ],
                'English': [
                    { id: 'Fenrir', name: 'James (Male)', type: 'Deep US Narrative', avatar: 'ðŸ‡ºðŸ‡¸' },
                    { id: 'Aoede', name: 'Emma (Female)', type: 'Soft British Accent', avatar: 'ðŸ‡¬ðŸ‡§' },
                    { id: 'Iapetus', name: 'Robert (Male)', type: 'Energetic Broadcaster', avatar: 'ðŸŽ™ï¸' },
                    { id: 'Leda', name: 'Sophie (Female)', type: 'Elegant Corporate', avatar: 'ðŸ¢' },
                ]
            };

            const styles = [
                { name: 'Santai', icon: 'â˜•', prompt: 'relaxed and casual' },
                { name: 'Storytelling', icon: 'ðŸ“–', prompt: 'captivating storytelling, with dramatic pauses and expressive narration like a book narrator' },
                { name: 'Reflektif', icon: 'ðŸ§˜', prompt: 'deep, thoughtful, calm, and reflective with a slow and meaningful pace' },
                { name: 'Dramatis', icon: 'ðŸŽ­', prompt: 'highly intense, emotional, and very dramatic' },
                { name: 'Inspiratif', icon: 'ðŸŒŸ', prompt: 'inspiring and motivational' },
                { name: 'Formal', icon: 'ðŸŽ™ï¸', prompt: 'formal, professional, and clear' },
            ];

            useEffect(() => {
                setSubLang(languageMap[mainLang][0]);
                setSelectedVoice(voiceDatabase[mainLang][0].id);
            }, [mainLang]);

            const encodeMp3 = (pcmData, sampleRate) => {
                if (!window.lamejs) return null;
                const mp3encoder = new window.lamejs.Mp3Encoder(1, sampleRate, 128);
                const mp3Data = [];
                const sampleBlockSize = 1152;
                for (let i = 0; i < pcmData.length; i += sampleBlockSize) {
                    const sampleChunk = pcmData.subarray(i, i + sampleBlockSize);
                    const mp3buf = mp3encoder.encodeBuffer(sampleChunk);
                    if (mp3buf.length > 0) mp3Data.push(mp3buf);
                }
                const mp3buf = mp3encoder.flush();
                if (mp3buf.length > 0) mp3Data.push(mp3buf);
                return new Blob(mp3Data, { type: 'audio/mp3' });
            };

            const generateVoice = async () => {
                if (!text) return;
                setIsGenerating(true);
                setError(null);
                setAudioUrl(null);

                const stylePrompt = styles.find(s => s.name === style)?.prompt || 'natural';
                const fullPrompt = `Voice Task: Speak as a native ${mainLang} speaker. 
                Sub-dialect/Accent: ${subLang}. 
                Mood/Style: ${stylePrompt}. 
                Text: ${text}`;

                const payload = {
                    contents: [{ parts: [{ text: fullPrompt }] }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: selectedVoice } } }
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    const audioData = result.candidates?.[0]?.content?.parts?.[0]?.inlineData;

                    if (!audioData) throw new Error('API Error');

                    const binaryString = atob(audioData.data);
                    const pcm16 = new Int16Array(binaryString.length / 2);
                    for (let i = 0; i < binaryString.length; i += 2) {
                        pcm16[i / 2] = (binaryString.charCodeAt(i + 1) << 8) | binaryString.charCodeAt(i);
                    }

                    const sampleRate = parseInt(audioData.mimeType.match(/rate=(\d+)/)?.[1] || "24000");
                    const mp3Blob = encodeMp3(pcm16, sampleRate);
                    setAudioUrl(URL.createObjectURL(mp3Blob));
                    setIsGenerating(false);
                } catch (err) {
                    setError("Gagal menghasilkan suara. Silakan coba beberapa saat lagi.");
                    setIsGenerating(false);
                }
            };

            return (
                <div className="min-h-screen p-4 md:p-10 flex flex-col items-center">
                    <div className="max-w-6xl w-full">
                        <header className="flex flex-col md:flex-row items-center justify-between mb-10 gap-6">
                            <div className="flex items-center gap-5">
                                <div className="bg-orange-500 p-4 rounded-3xl shadow-2xl shadow-orange-500/30">
                                    <Icon name="Mic2" className="w-8 h-8 text-white" />
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black tracking-tight">
                                        <span className="text-orange-500">Mbah</span>
                                        <span className="text-white">Klowor</span> 
                                        <span className="text-white/60 ml-2 text-xl font-light">AI Voice Over Studio</span>
                                    </h1>
                                    <p className="text-[10px] font-bold text-gray-500 tracking-[0.4em] uppercase">Narrative Excellence Studio</p>
                                </div>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <div className="lg:col-span-8 space-y-6">
                                <div className="glass-card rounded-[2.5rem] p-8 shadow-2xl relative">
                                    <textarea
                                        className="w-full h-[460px] bg-transparent border-none focus:ring-0 text-2xl leading-relaxed resize-none custom-scrollbar font-medium placeholder-gray-800"
                                        value={text}
                                        onChange={(e) => setText(e.target.value)}
                                        placeholder="Tuliskan Kata/Kalimat Disini..."
                                    />
                                    {isGenerating && (
                                        <div className="absolute inset-0 bg-black/80 backdrop-blur-xl flex flex-col items-center justify-center rounded-[2.5rem] z-50">
                                            <div className="w-20 h-20 border-4 border-orange-500/10 border-t-orange-500 rounded-full animate-spin mb-6"></div>
                                            <p className="font-black text-xl tracking-[0.2em] text-white uppercase">MERACIK SUARA...</p>
                                        </div>
                                    )}
                                </div>

                                <div className="flex flex-wrap gap-4">
                                    <button 
                                        onClick={generateVoice}
                                        disabled={isGenerating}
                                        className="flex-1 md:flex-none px-12 py-5 bg-orange-600 hover:bg-orange-500 rounded-2xl font-black text-lg transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-orange-600/20 uppercase"
                                    >
                                        <Icon name="Zap" className="w-6 h-6 fill-white" /> GENERATE SEKARANG
                                    </button>
                                    
                                    {audioUrl && (
                                        <div className="flex gap-3 w-full md:w-auto">
                                            <button onClick={() => audioRef.current.play()} className="flex-1 px-10 py-5 bg-white/5 hover:bg-white/10 rounded-2xl font-bold flex items-center justify-center gap-2 border border-white/10 uppercase">
                                                <Icon name="PlayCircle" className="w-6 h-6" /> PLAY
                                            </button>
                                            <button onClick={() => { const a = document.createElement('a'); a.href = audioUrl; a.download = 'mbah-klowor-narrative.mp3'; a.click(); }} 
                                                className="flex-1 px-8 py-5 bg-green-500/10 text-green-400 border border-green-500/20 rounded-2xl font-bold flex items-center justify-center gap-2 uppercase">
                                                <Icon name="Download" className="w-6 h-6" /> DOWNLOAD
                                            </button>
                                        </div>
                                    )}
                                </div>
                                {audioUrl && <audio ref={audioRef} src={audioUrl} className="hidden" />}
                                {error && <div className="p-4 bg-red-500/10 text-red-500 rounded-2xl text-xs font-bold border border-red-500/20">{error}</div>}
                            </div>

                            <div className="lg:col-span-4 space-y-6">
                                <div className="glass-card rounded-3xl p-6 border-orange-500/10">
                                    <h3 className="text-[10px] font-black uppercase text-gray-500 mb-5 tracking-widest flex items-center gap-2">
                                        <Icon name="Globe" className="w-4 h-4 text-orange-500" /> Bahasa & Logat
                                    </h3>
                                    <div className="space-y-5">
                                        <div className="flex p-1 bg-black/40 rounded-xl border border-white/5">
                                            {Object.keys(languageMap).map(lang => (
                                                <button 
                                                    key={lang}
                                                    onClick={() => setMainLang(lang)}
                                                    className={`flex-1 py-2.5 rounded-lg text-[10px] font-black uppercase transition-all ${mainLang === lang ? 'bg-orange-500 text-white shadow-lg' : 'text-gray-500 hover:text-white'}`}
                                                >
                                                    {lang}
                                                </button>
                                            ))}
                                        </div>
                                        <select 
                                            className="w-full bg-black/40 border border-white/10 rounded-xl p-4 text-sm font-bold outline-none cursor-pointer focus:border-orange-500/50"
                                            value={subLang}
                                            onChange={(e) => setSubLang(e.target.value)}
                                        >
                                            {languageMap[mainLang].map(sub => <option key={sub} className="bg-[#0a0c10]">{sub}</option>)}
                                        </select>
                                    </div>
                                </div>

                                <div className="glass-card rounded-3xl p-6">
                                    <h3 className="text-[10px] font-black uppercase text-gray-500 mb-5 tracking-widest flex items-center gap-2">
                                        <Icon name="Sparkles" className="w-4 h-4 text-orange-500" /> Gaya Narasi
                                    </h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        {styles.map(s => (
                                            <button 
                                                key={s.name}
                                                onClick={() => setStyle(s.name)}
                                                className={`p-4 rounded-2xl border text-[9px] font-black uppercase transition-all flex flex-col items-center gap-3 ${style === s.name ? 'bg-orange-500/20 border-orange-500 text-orange-500' : 'bg-white/5 border-transparent text-gray-500 hover:bg-white/10'}`}
                                            >
                                                <span className="text-2xl">{s.icon}</span>
                                                {s.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="glass-card rounded-3xl p-6">
                                    <h3 className="text-[10px] font-black uppercase text-gray-500 mb-5 tracking-widest flex items-center gap-2">
                                        <Icon name="UserCheck" className="w-4 h-4 text-orange-500" /> Voice Character ({mainLang})
                                    </h3>
                                    <div className="space-y-3">
                                        {voiceDatabase[mainLang].map(v => (
                                            <button 
                                                key={v.id}
                                                onClick={() => setSelectedVoice(v.id)}
                                                className={`w-full flex items-center gap-4 p-4 rounded-2xl transition-all border ${selectedVoice === v.id ? 'bg-orange-500/10 border-orange-500 text-white shadow-lg' : 'bg-transparent border-transparent hover:bg-white/5 text-gray-500'}`}
                                            >
                                                <span className="text-3xl bg-black/40 p-2 rounded-2xl">{v.avatar}</span>
                                                <div className="text-left">
                                                    <div className="font-black text-xs">{v.name}</div>
                                                    <div className="text-[9px] font-medium opacity-50 uppercase tracking-tight">{v.type}</div>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <footer className="mt-16 mb-8 text-[10px] font-bold text-gray-800 tracking-[0.4em] uppercase">
                        &copy; 2026 MbahKlowor AI Voice Over Studio â€¢ Master of Sound
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
